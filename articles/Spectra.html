<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Description and usage of Spectra objects • Spectra</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Description and usage of Spectra objects">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Spectra</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/Spectra.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/RforMassSpectrometry/Spectra">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Description and usage of Spectra objects</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/RforMassSpectrometry/Spectra/blob/master/vignettes/Spectra.Rmd"><code>vignettes/Spectra.Rmd</code></a></small>
      <div class="hidden name"><code>Spectra.Rmd</code></div>

    </div>

    
    
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function() {
  document.querySelector("h1").className = "title";
});
</script><script type="text/javascript">
document.addEventListener("DOMContentLoaded", function() {
  var links = document.links;  
  for (var i = 0, linksLength = links.length; i < linksLength; i++)
    if (links[i].hostname != window.location.hostname)
      links[i].target = '_blank';
});
</script><p><strong>Package</strong>: <em><a href="https://bioconductor.org/packages/3.11/Spectra">Spectra</a></em><br><strong>Authors</strong>: Laurent Gatto, Johannes Rainer and Sebastian Gibb.<br><strong>Last modified:</strong> 2019-12-05 09:09:46<br><strong>Compiled</strong>: Thu Dec 5 09:15:25 2019</p>
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>The <code>Spectra</code> package provides a scalable and flexible infrastructure to represent, retrieve and handle mass spectrometry (MS) data. The <code>Spectra</code> object provides the user with a single standardized interface to access and manipulate MS data while supporting, through the concept of exchangeable <em>backends</em>, a large variety of different ways to store and retrieve mass spectrometry data. Such backends range from mzML/mzXML/CDF files, simple flat files, or database systems.</p>
</div>
<div id="general-usage" class="section level1">
<h1 class="hasAnchor">
<a href="#general-usage" class="anchor"></a>General usage</h1>
<p>Mass spectrometry data in <code>Spectra</code> objects can be thought of as a list of individual spectra, with each spectrum having a set of variables associated with it. Besides <em>core</em> spectra variables (such as MS level or retention time) an arbitrary number of optional variables can be assigned to a spectrum. The core spectra variables all have their own accessor method and it is guaranteed that a value is returned by it (or <code>NA</code> if the information is not available). The core variables and their data type are (alphabetically ordered):</p>
<ul>
<li>
<em>acquisitionNum</em> <code><a href="https://rdrr.io/r/base/integer.html">integer(1)</a></code>: the index of acquisition of a spectrum during a MS run.</li>
<li>
<em>centroided</em> <code><a href="https://rdrr.io/r/base/logical.html">logical(1)</a></code>: whether the spectrum is in profile or centroid mode.</li>
<li>
<em>collisionEnergy</em> <code><a href="https://rdrr.io/r/base/numeric.html">numeric(1)</a></code>: collision energy used to create an MSn spectrum.</li>
<li>
<em>dataOrigin</em> <code><a href="https://rdrr.io/r/base/character.html">character(1)</a></code>: the <em>origin</em> of the spectrum’s data, e.g. the mzML file from which it was read.</li>
<li>
<em>dataStorage</em> <code><a href="https://rdrr.io/r/base/character.html">character(1)</a></code>: the (current) storage location of the spectrum data. This value depends on the backend used to handle and provide the data. For an <em>in-memory</em> backend like the <code>MsBackendDataFrame</code> this will be <code>"&lt;memory&gt;"</code>, for an on-disk backend such as the <code>MsBackendHdf5Peaks</code> it will be the name of the HDF5 file where the spectrum’s peak data is stored.</li>
<li>
<em>intensity</em> <code>numeric</code>: intensity values for the spectrum’s peaks.</li>
<li>
<em>isolationWindowLowerMz</em> <code><a href="https://rdrr.io/r/base/numeric.html">numeric(1)</a></code>: lower m/z for the isolation window in which the (MSn) spectrum was measured.</li>
<li>
<em>isolationWindowTargetMz</em> <code><a href="https://rdrr.io/r/base/numeric.html">numeric(1)</a></code>: the target m/z for the isolation window in which the (MSn) spectrum was measured.</li>
<li>
<em>isolationWindowUpperMz</em> <code><a href="https://rdrr.io/r/base/numeric.html">numeric(1)</a></code>: upper m/z for the isolation window in which the (MSn) spectrum was measured.</li>
<li>
<em>msLevel</em> <code><a href="https://rdrr.io/r/base/integer.html">integer(1)</a></code>: the MS level of the spectrum.</li>
<li>
<em>mz</em> <code>numeric</code>: the m/z values for the spectrum’s peaks.</li>
<li>
<em>polarity</em> <code><a href="https://rdrr.io/r/base/integer.html">integer(1)</a></code>: the polarity of the spectrum (<code>0</code> and <code>1</code> representing negative and positive polarity, respectively).</li>
<li>
<em>precScanNum</em> <code><a href="https://rdrr.io/r/base/integer.html">integer(1)</a></code>: the scan (acquisition) number of the precursor for an MSn spectrum.</li>
<li>
<em>precursorCharge</em> <code><a href="https://rdrr.io/r/base/integer.html">integer(1)</a></code>: the charge of the precursor of an MSn spectrum.</li>
<li>
<em>precursorIntensity</em> <code><a href="https://rdrr.io/r/base/numeric.html">numeric(1)</a></code>: the intensity of the precursor of an MSn spectrum.</li>
<li>
<em>precursorMz</em> <code><a href="https://rdrr.io/r/base/numeric.html">numeric(1)</a></code>: the m/z of the precursor of an MSn spectrum.</li>
<li>
<em>rtime</em> <code><a href="https://rdrr.io/r/base/numeric.html">numeric(1)</a></code>: the retention time of a spectrum.</li>
<li>
<em>scanIndex</em> <code><a href="https://rdrr.io/r/base/integer.html">integer(1)</a></code>: the index of a spectrum within a (raw) file.</li>
<li>
<em>smoothed</em> <code><a href="https://rdrr.io/r/base/logical.html">logical(1)</a></code>: whether the spectrum was smoothed.</li>
</ul>
<p>For details on the individual variables and their getter/setter function see the help for <code>Spectra</code> (<code><a href="../reference/Spectra.html">?Spectra</a></code>). Also note that these variables are suggested, but not required to characterize a spectrum. Also, some only make sense for MSn, but not for MS1 spectra.</p>
<div id="creating-spectra-objects" class="section level2">
<h2 class="hasAnchor">
<a href="#creating-spectra-objects" class="anchor"></a>Creating <code>Spectra</code> objects</h2>
<p>The simplest way to create a <code>Spectra</code> object is by defining a <code>DataFrame</code> with the corresponding spectra data (using the corresponding spectra variable names as column names) and passing that to the <code>Spectra</code> constructor function. Below we create such an object for a set of 3 spectra providing their MS level, polarity but also additional annotations such as their ID in <a href="http://hmdb.ca">HMDB</a> (human metabolome database) and their name. The m/z and intensity values for each spectrum have to be provided as a <code>list</code> of <code>numeric</code> values.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(Spectra)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"></a>
<a class="sourceLine" id="cb1-3" data-line-number="3">spd &lt;-<span class="st"> </span><span class="kw">DataFrame</span>(</a>
<a class="sourceLine" id="cb1-4" data-line-number="4">    <span class="dt">msLevel =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(2L, 2L, 2L),</a>
<a class="sourceLine" id="cb1-5" data-line-number="5">    <span class="dt">polarity =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(1L, 1L, 1L),</a>
<a class="sourceLine" id="cb1-6" data-line-number="6">    <span class="dt">id =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"HMDB0000001"</span>, <span class="st">"HMDB0000001"</span>, <span class="st">"HMDB0001847"</span>),</a>
<a class="sourceLine" id="cb1-7" data-line-number="7">    <span class="dt">name =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"1-Methylhistidine"</span>, <span class="st">"1-Methylhistidine"</span>, <span class="st">"Caffeine"</span>))</a>
<a class="sourceLine" id="cb1-8" data-line-number="8"></a>
<a class="sourceLine" id="cb1-9" data-line-number="9">## Assign m/z and intensity values.</a>
<a class="sourceLine" id="cb1-10" data-line-number="10">spd<span class="op">$</span>mz &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(</a>
<a class="sourceLine" id="cb1-11" data-line-number="11">    <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">109.2</span>, <span class="fl">124.2</span>, <span class="fl">124.5</span>, <span class="fl">170.16</span>, <span class="fl">170.52</span>),</a>
<a class="sourceLine" id="cb1-12" data-line-number="12">    <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">83.1</span>, <span class="fl">96.12</span>, <span class="fl">97.14</span>, <span class="fl">109.14</span>, <span class="fl">124.08</span>, <span class="fl">125.1</span>, <span class="fl">170.16</span>),</a>
<a class="sourceLine" id="cb1-13" data-line-number="13">    <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">56.0494</span>, <span class="fl">69.0447</span>, <span class="fl">83.0603</span>, <span class="fl">109.0395</span>, <span class="fl">110.0712</span>,</a>
<a class="sourceLine" id="cb1-14" data-line-number="14">      <span class="fl">111.0551</span>, <span class="fl">123.0429</span>, <span class="fl">138.0662</span>, <span class="fl">195.0876</span>))</a>
<a class="sourceLine" id="cb1-15" data-line-number="15">spd<span class="op">$</span>intensity &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(</a>
<a class="sourceLine" id="cb1-16" data-line-number="16">    <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">3.407</span>, <span class="fl">47.494</span>, <span class="fl">3.094</span>, <span class="fl">100.0</span>, <span class="fl">13.240</span>),</a>
<a class="sourceLine" id="cb1-17" data-line-number="17">    <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">6.685</span>, <span class="fl">4.381</span>, <span class="fl">3.022</span>, <span class="fl">16.708</span>, <span class="fl">100.0</span>, <span class="fl">4.565</span>, <span class="fl">40.643</span>),</a>
<a class="sourceLine" id="cb1-18" data-line-number="18">    <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.459</span>, <span class="fl">2.585</span>, <span class="fl">2.446</span>, <span class="fl">0.508</span>, <span class="fl">8.968</span>, <span class="fl">0.524</span>, <span class="fl">0.974</span>, <span class="fl">100.0</span>, <span class="fl">40.994</span>))</a>
<a class="sourceLine" id="cb1-19" data-line-number="19"></a>
<a class="sourceLine" id="cb1-20" data-line-number="20">sps &lt;-<span class="st"> </span><span class="kw"><a href="../reference/Spectra.html">Spectra</a></span>(spd)</a>
<a class="sourceLine" id="cb1-21" data-line-number="21">sps</a></code></pre></div>
<pre><code>## MSn data (Spectra) with 3 spectra in a MsBackendDataFrame backend:
##     msLevel     rtime scanIndex
##   &lt;integer&gt; &lt;numeric&gt; &lt;integer&gt;
## 1         2        NA        NA
## 2         2        NA        NA
## 3         2        NA        NA
##  ... 18 more variables/columns.
## Processing:
## </code></pre>
<p>Alternatively, it is possible to import spectra data from mass spectrometry raw files in mzML/mzXML or CDF format. Below we create a <code>Spectra</code> object from two mzML files and define to use a <code>MsBackendMzR</code> backend to <em>store</em> the data (note that this requires the <em><a href="https://bioconductor.org/packages/3.11/mzR">mzR</a></em> package to be installed). This backend, specifically designed for raw MS data, keeps only a subset of spectra variables in memory while reading the m/z and intensity values from the original data files only on demand. See section <a href="#backends">Backends</a> for more details on backends and their properties.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">fls &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.files.html">dir</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"sciex"</span>, <span class="dt">package =</span> <span class="st">"msdata"</span>), <span class="dt">full.names =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">sps_sciex &lt;-<span class="st"> </span><span class="kw"><a href="../reference/Spectra.html">Spectra</a></span>(fls, <span class="dt">backend =</span> <span class="kw"><a href="../reference/MsBackend.html">MsBackendMzR</a></span>())</a>
<a class="sourceLine" id="cb3-3" data-line-number="3">sps_sciex</a></code></pre></div>
<pre><code>## MSn data (Spectra) with 1862 spectra in a MsBackendMzR backend:
##        msLevel         rtime scanIndex
##      &lt;integer&gt;     &lt;numeric&gt; &lt;integer&gt;
## 1            1 0.28000000002         1
## 2            1 0.55900000002         2
## 3            1 0.83800000002         3
## 4            1 1.11700000002         4
## 5            1 1.39600000002         5
## ...        ...           ...       ...
## 1858         1       258.636       927
## 1859         1       258.915       928
## 1860         1       259.194       929
## 1861         1       259.473       930
## 1862         1       259.752       931
##  ... 33 more variables/columns.
## 
## file(s):
## 20171016_POOL_POS_1_105-134.mzML
## 20171016_POOL_POS_3_105-134.mzML
## Processing:
## </code></pre>
<p>The <code>Spectra</code> object <code>sps_sciex</code> allows now to access spectra data from 1862 MS1 spectra and uses <code>MsBackendMzR</code> as backend (the <code>Spectra</code> object <code>sps</code> created in the previous code block uses the default <code>MsBackendDataFrame</code>).</p>
</div>
<div id="accessing-spectrum-data" class="section level2">
<h2 class="hasAnchor">
<a href="#accessing-spectrum-data" class="anchor"></a>Accessing spectrum data</h2>
<p>As detailed above <code>Spectra</code> objects can contain an arbitrary number of properties of a spectrum (so called <em>spectra variables</em>). The available variables can be listed with the <code>spectraVariables</code> method:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw">spectraVariables</span>(sps)</a></code></pre></div>
<pre><code>##  [1] "msLevel"                 "rtime"                  
##  [3] "acquisitionNum"          "scanIndex"              
##  [5] "mz"                      "intensity"              
##  [7] "dataStorage"             "dataOrigin"             
##  [9] "centroided"              "smoothed"               
## [11] "polarity"                "precScanNum"            
## [13] "precursorMz"             "precursorIntensity"     
## [15] "precursorCharge"         "collisionEnergy"        
## [17] "isolationWindowLowerMz"  "isolationWindowTargetMz"
## [19] "isolationWindowUpperMz"  "id"                     
## [21] "name"</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw">spectraVariables</span>(sps_sciex)</a></code></pre></div>
<pre><code>##  [1] "msLevel"                  "rtime"                   
##  [3] "acquisitionNum"           "scanIndex"               
##  [5] "mz"                       "intensity"               
##  [7] "dataStorage"              "dataOrigin"              
##  [9] "centroided"               "smoothed"                
## [11] "polarity"                 "precScanNum"             
## [13] "precursorMz"              "precursorIntensity"      
## [15] "precursorCharge"          "collisionEnergy"         
## [17] "isolationWindowLowerMz"   "isolationWindowTargetMz" 
## [19] "isolationWindowUpperMz"   "peaksCount"              
## [21] "totIonCurrent"            "basePeakMZ"              
## [23] "basePeakIntensity"        "ionisationEnergy"        
## [25] "lowMZ"                    "highMZ"                  
## [27] "mergedScan"               "mergedResultScanNum"     
## [29] "mergedResultStartScanNum" "mergedResultEndScanNum"  
## [31] "injectionTime"            "filterString"            
## [33] "spectrumId"               "ionMobilityDriftTime"    
## [35] "scanWindowLowerLimit"     "scanWindowUpperLimit"</code></pre>
<p>The two <code>Spectra</code> contain a different set of variables: besides <code>"msLevel"</code>, <code>"polarity"</code>, <code>"id"</code> and <code>"name"</code>, that were specified for the <code>Spectra</code> object <code>sps</code>, it contains more variables such as <code>"rtime"</code>, <code>"acquisitionNum"</code> and <code>"scanIndex"</code>. These are part of the <em>core variables</em> defining a spectrum and for all of these accessor methods exist. Below we use <code>msLevel</code> and <code>rtime</code> to access the MS levels and retention times for the spectra in <code>sps</code>.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw">msLevel</span>(sps)</a></code></pre></div>
<pre><code>## [1] 2 2 2</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="kw">rtime</span>(sps)</a></code></pre></div>
<pre><code>## [1] NA NA NA</code></pre>
<p>We did not specify retention times for the spectra in <code>sps</code> thus <code>NA</code> is returned for them. The <code>Spectra</code> object <code>sps_sciex</code> contains many more variables, all of which were extracted from the mzML files. Below we extract the retention times for the first spectra in the object.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="kw">rtime</span>(sps_sciex))</a></code></pre></div>
<pre><code>## [1] 0.280 0.559 0.838 1.117 1.396 1.675</code></pre>
<p>Note that in addition to the accessor functions it is also possible to use <code><a href="https://rdrr.io/r/base/Extract.html">$</a></code> to extract a specific spectra variable. To extract the name of the compounds in <code>sps</code> we can use <code>sps$name</code>, or, to extract the MS levels <code>sps$msLevel</code>.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">sps<span class="op">$</span>name</a></code></pre></div>
<pre><code>## [1] "1-Methylhistidine" "1-Methylhistidine" "Caffeine"</code></pre>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">sps<span class="op">$</span>msLevel</a></code></pre></div>
<pre><code>## [1] 2 2 2</code></pre>
<p>We could also replace specific spectra variables using either the dedicated method or <code><a href="https://rdrr.io/r/base/Extract.html">$</a></code>. Below we specify that all spectra in <code>sps</code> represent centroided data.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1">sps<span class="op">$</span>centroided &lt;-<span class="st"> </span><span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb19-2" data-line-number="2"></a>
<a class="sourceLine" id="cb19-3" data-line-number="3"><span class="kw">centroided</span>(sps)</a></code></pre></div>
<pre><code>## [1] TRUE TRUE TRUE</code></pre>
<p>The <code><a href="https://rdrr.io/r/base/Extract.html">$</a></code> operator can also be used to add arbitrary new spectra variables to a <code>Spectra</code> object. Below we add the SPLASH key to each of the spectra.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1">sps<span class="op">$</span>splash &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(</a>
<a class="sourceLine" id="cb21-2" data-line-number="2">    <span class="st">"splash10-00di-0900000000-037d24a7d65676b7e356"</span>,</a>
<a class="sourceLine" id="cb21-3" data-line-number="3">    <span class="st">"splash10-00di-0900000000-03e99316bd6c098f5d11"</span>,</a>
<a class="sourceLine" id="cb21-4" data-line-number="4">    <span class="st">"splash10-000i-0900000000-9af60e39c843cb715435"</span>)</a></code></pre></div>
<p>This new spectra variable will now be listed as an additional variable in the result of the <code>spectraVariables</code> function and we can directly access its content with <code>sps$splash</code>.</p>
<p>Each spectrum can have a different number of mass peaks, each consisting of a mass-to-charge (m/z) and associated intensity value. These can be extracted with the <code>mz</code> or <code>intensity</code> functions, each of which return a <code>list</code> of <code>numeric</code> values.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1"><span class="kw">mz</span>(sps)</a></code></pre></div>
<pre><code>## NumericList of length 3
## [[1]] 109.2 124.2 124.5 170.16 170.52
## [[2]] 83.1 96.12 97.14 109.14 124.08 125.1 170.16
## [[3]] 56.0494 69.0447 83.0603 109.0395 110.0712 111.0551 123.0429 138.0662 195.0876</code></pre>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1"><span class="kw">intensity</span>(sps)</a></code></pre></div>
<pre><code>## NumericList of length 3
## [[1]] 3.407 47.494 3.094 100 13.24
## [[2]] 6.685 4.381 3.022 16.708 100 4.565 40.643
## [[3]] 0.459 2.585 2.446 0.508 8.968 0.524 0.974 100 40.994</code></pre>
<p>Peak data can also be extracted with the <code>as.list</code> function that returns a list of matrices, each with columns <code>"mz"</code> and <code>"intensity"</code> containing the m/z and intensity values for one spectrum.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1">pks &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">as.list</a></span>(sps)</a>
<a class="sourceLine" id="cb26-2" data-line-number="2">pks[[<span class="dv">1</span>]]</a></code></pre></div>
<pre><code>##          mz intensity
## [1,] 109.20     3.407
## [2,] 124.20    47.494
## [3,] 124.50     3.094
## [4,] 170.16   100.000
## [5,] 170.52    13.240</code></pre>
<p>The <code>spectraData</code> function returns a <code>DataFrame</code> with the full data for each spectrum, or with selected spectra variables (which can be specified with the <code>columns</code> parameter). Below we extract the spectra data for variables <code>"msLevel"</code>, <code>"id"</code> and <code>"name"</code>.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" data-line-number="1"><span class="kw">spectraData</span>(sps, <span class="dt">columns =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"msLevel"</span>, <span class="st">"id"</span>, <span class="st">"name"</span>))</a></code></pre></div>
<pre><code>## DataFrame with 3 rows and 3 columns
##     msLevel          id              name
##   &lt;integer&gt; &lt;character&gt;       &lt;character&gt;
## 1         2 HMDB0000001 1-Methylhistidine
## 2         2 HMDB0000001 1-Methylhistidine
## 3         2 HMDB0001847          Caffeine</code></pre>
<p><code>Spectra</code> are one-dimensional objects storing spectra, even from different files or samples, in a single list. Specific variables have thus to be used to define the originating file from which they were extracted or the sample in which they were measured. The <em>data origin</em> of each spectrum can be extracted with the <code>dataOrigin</code> function. For <code>sps</code>, the <code>Spectra</code> created from a <code>DataFrame</code>, this will be <code>NA</code> because we did not specify the data origin:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" data-line-number="1"><span class="kw">dataOrigin</span>(sps)</a></code></pre></div>
<pre><code>## [1] NA NA NA</code></pre>
<p><code>dataOrigin</code> for <code>sps_sciex</code>, the <code>Spectra</code> which was initialized with data from mzML files, in contrast, returns the originating file names:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/basename.html">basename</a></span>(<span class="kw">dataOrigin</span>(sps_sciex)))</a></code></pre></div>
<pre><code>## [1] "20171016_POOL_POS_1_105-134.mzML" "20171016_POOL_POS_1_105-134.mzML"
## [3] "20171016_POOL_POS_1_105-134.mzML" "20171016_POOL_POS_1_105-134.mzML"
## [5] "20171016_POOL_POS_1_105-134.mzML" "20171016_POOL_POS_1_105-134.mzML"</code></pre>
<p>The current data storage location of a spectrum can be retrieved with the <code>dataStorage</code> variable, which will return an arbitrary string for <code>Spectra</code> that use an in-memory backend or the file where the data is stored for on-disk backends:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" data-line-number="1"><span class="kw">dataStorage</span>(sps)</a></code></pre></div>
<pre><code>## [1] "&lt;memory&gt;" "&lt;memory&gt;" "&lt;memory&gt;"</code></pre>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/basename.html">basename</a></span>(<span class="kw">dataStorage</span>(sps_sciex)))</a></code></pre></div>
<pre><code>## [1] "20171016_POOL_POS_1_105-134.mzML" "20171016_POOL_POS_1_105-134.mzML"
## [3] "20171016_POOL_POS_1_105-134.mzML" "20171016_POOL_POS_1_105-134.mzML"
## [5] "20171016_POOL_POS_1_105-134.mzML" "20171016_POOL_POS_1_105-134.mzML"</code></pre>
</div>
<div id="filtering-subsetting-and-merging" class="section level2">
<h2 class="hasAnchor">
<a href="#filtering-subsetting-and-merging" class="anchor"></a>Filtering, subsetting and merging</h2>
<p>Apart from <em>classical</em> subsetting operations such as <code><a href="https://rdrr.io/r/base/Extract.html">[</a></code> and <code>split</code>, a set of filter functions are defined for <code>Spectra</code> objects (for detailed help please see the <code><a href="../reference/Spectra.html">?Spectra</a></code> help):</p>
<ul>
<li>
<code>filterAcquisitionNum</code>: retain spectra with certain acquisition numbers.</li>
<li>
<code>filterEmptySpectra</code>: remove spectra without mass peaks.</li>
<li>
<code>filterDataOrigin</code>: subset to spectra from specific origins.</li>
<li>
<code>filterDataStorage</code>: subset to spectra from certain data storage files.</li>
<li>
<code>filterIsolationWindow</code>: keep spectra with the provided <code>mz</code> in their isolation window (m/z range).</li>
<li>
<code>filterMsLevel</code>: filter by MS level.</li>
<li>
<code>filterPolarity</code>: filter by polarity.</li>
<li>
<code>filterPrecursorMz</code>: retain (MSn) spectra with a precursor m/z within the provided m/z range.</li>
<li>
<code>filterPrecursorScan</code>: retain (parent and children) scans of an acquisition number.</li>
<li>
<code>filterRt</code>: filter based on retention time ranges.</li>
</ul>
<p>In the example below we select all spectra measured in the second mzML file and subsequently filter them to retain spectra measured between 175 and 189 seconds in the measurement run.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb38-1" data-line-number="1">fls &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="kw">dataOrigin</span>(sps_sciex))</a>
<a class="sourceLine" id="cb38-2" data-line-number="2">file_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">filterDataOrigin</span>(sps_sciex, <span class="dt">dataOrigin =</span> fls[<span class="dv">2</span>])</a>
<a class="sourceLine" id="cb38-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(file_<span class="dv">2</span>)</a></code></pre></div>
<pre><code>## [1] 931</code></pre>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb40-1" data-line-number="1">sps_sub &lt;-<span class="st"> </span><span class="kw">filterRt</span>(file_<span class="dv">2</span>, <span class="dt">rt =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">175</span>, <span class="dv">189</span>))</a>
<a class="sourceLine" id="cb40-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(sps_sub)</a></code></pre></div>
<pre><code>## [1] 50</code></pre>
<p>In addition, <code>Spectra</code> support also subsetting with <code><a href="https://rdrr.io/r/base/Extract.html">[</a></code>. Below we perform the filtering above with <code><a href="https://rdrr.io/r/base/Extract.html">[</a></code> -based subsetting.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb42-1" data-line-number="1">sps_sciex[sps_sciex<span class="op">$</span>dataOrigin <span class="op">==</span><span class="st"> </span>fls[<span class="dv">2</span>] <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb42-2" data-line-number="2"><span class="st">          </span>sps_sciex<span class="op">$</span>rtime <span class="op">&gt;=</span><span class="st"> </span><span class="dv">175</span> <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb42-3" data-line-number="3"><span class="st">          </span>sps_sciex<span class="op">$</span>rtime <span class="op">&lt;=</span><span class="st"> </span><span class="dv">189</span>]</a></code></pre></div>
<pre><code>## MSn data (Spectra) with 50 spectra in a MsBackendMzR backend:
##       msLevel           rtime scanIndex
##     &lt;integer&gt;       &lt;numeric&gt; &lt;integer&gt;
## 1           1         175.212       628
## 2           1         175.491       629
## 3           1          175.77       630
## 4           1         176.049       631
## 5           1         176.328       632
## ...       ...             ...       ...
## 46          1 187.76800000002       673
## 47          1 188.04700000002       674
## 48          1 188.32600000002       675
## 49          1 188.60500000002       676
## 50          1 188.88400000002       677
##  ... 33 more variables/columns.
## 
## file(s):
## 20171016_POOL_POS_3_105-134.mzML
## Processing:
## </code></pre>
<p>The equivalent using filter function is shown below, with the added benefit that the filtering is recorded in the processing slot.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb44-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"magrittr"</span>)</a>
<a class="sourceLine" id="cb44-2" data-line-number="2">sps_sciex <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb44-3" data-line-number="3"><span class="st">    </span><span class="kw">filterDataOrigin</span>(fls[<span class="dv">2</span>]) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb44-4" data-line-number="4"><span class="st">    </span><span class="kw">filterRt</span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">175</span>, <span class="dv">189</span>))</a></code></pre></div>
<pre><code>## MSn data (Spectra) with 50 spectra in a MsBackendMzR backend:
##       msLevel           rtime scanIndex
##     &lt;integer&gt;       &lt;numeric&gt; &lt;integer&gt;
## 1           1         175.212       628
## 2           1         175.491       629
## 3           1          175.77       630
## 4           1         176.049       631
## 5           1         176.328       632
## ...       ...             ...       ...
## 46          1 187.76800000002       673
## 47          1 188.04700000002       674
## 48          1 188.32600000002       675
## 49          1 188.60500000002       676
## 50          1 188.88400000002       677
##  ... 33 more variables/columns.
## 
## file(s):
## 20171016_POOL_POS_3_105-134.mzML
## Processing:
##  Filter: select data origin(s) /home/travis/R/Library/msdata/sciex/20171016_POOL_POS_3_105-134.mzML [Thu Dec  5 09:15:28 2019]
##  Filter: select retention time [175..189] on MS level(s) 1 [Thu Dec  5 09:15:28 2019]</code></pre>
<p>Note that the use of the filter functions might be more efficient for some backends, depending on their implementation, (e.g. database-based backends could <em>translate</em> the filter function into a SQL condition to perform the subsetting already within the database).</p>
<p>Multiple <code>Spectra</code> objects can also be combined into a single <code>Spectra</code> with the <code>c</code> function. The resulting <code>Spectra</code> object will contain an union of the spectra variables of the individual objects. Below we combine the <code>Spectra</code> object <code>sps</code> with an additional object containing another MS2 spectrum for Caffeine.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb46-1" data-line-number="1">caf_df &lt;-<span class="st"> </span><span class="kw">DataFrame</span>(<span class="dt">msLevel =</span> 2L, <span class="dt">name =</span> <span class="st">"Caffeine"</span>,</a>
<a class="sourceLine" id="cb46-2" data-line-number="2">                    <span class="dt">id =</span> <span class="st">"HMDB0001847"</span>,</a>
<a class="sourceLine" id="cb46-3" data-line-number="3">                    <span class="dt">instrument =</span> <span class="st">"Agilent 1200 RRLC; Agilent 6520 QTOF"</span>,</a>
<a class="sourceLine" id="cb46-4" data-line-number="4">                    <span class="dt">splash =</span> <span class="st">"splash10-0002-0900000000-413259091ba7edc46b87"</span>,</a>
<a class="sourceLine" id="cb46-5" data-line-number="5">                    <span class="dt">centroided =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb46-6" data-line-number="6">caf_df<span class="op">$</span>mz &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">110.0710</span>, <span class="fl">138.0655</span>, <span class="fl">138.1057</span>, <span class="fl">138.1742</span>, <span class="fl">195.9864</span>))</a>
<a class="sourceLine" id="cb46-7" data-line-number="7">caf_df<span class="op">$</span>intensity &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">3.837</span>, <span class="fl">32.341</span>, <span class="fl">0.84</span>, <span class="fl">0.534</span>, <span class="dv">100</span>))</a>
<a class="sourceLine" id="cb46-8" data-line-number="8"></a>
<a class="sourceLine" id="cb46-9" data-line-number="9">caf &lt;-<span class="st"> </span><span class="kw"><a href="../reference/Spectra.html">Spectra</a></span>(caf_df)</a></code></pre></div>
<p>Next we combine the two objects.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb47-1" data-line-number="1">sps &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(sps, caf)</a>
<a class="sourceLine" id="cb47-2" data-line-number="2">sps</a></code></pre></div>
<pre><code>## MSn data (Spectra) with 4 spectra in a MsBackendDataFrame backend:
##     msLevel     rtime scanIndex
##   &lt;integer&gt; &lt;numeric&gt; &lt;integer&gt;
## 1         2        NA        NA
## 2         2        NA        NA
## 3         2        NA        NA
## 4         2        NA        NA
##  ... 20 more variables/columns.
## Processing:
##  Merge 2 Spectra into one [Thu Dec  5 09:15:29 2019]</code></pre>
<p>The resulting object contains now the data for all 4 MS2 spectra and an union of all spectra variables from both objects.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb49-1" data-line-number="1"><span class="kw">spectraVariables</span>(sps)</a></code></pre></div>
<pre><code>##  [1] "msLevel"                 "rtime"                  
##  [3] "acquisitionNum"          "scanIndex"              
##  [5] "mz"                      "intensity"              
##  [7] "dataStorage"             "dataOrigin"             
##  [9] "centroided"              "smoothed"               
## [11] "polarity"                "precScanNum"            
## [13] "precursorMz"             "precursorIntensity"     
## [15] "precursorCharge"         "collisionEnergy"        
## [17] "isolationWindowLowerMz"  "isolationWindowTargetMz"
## [19] "isolationWindowUpperMz"  "id"                     
## [21] "name"                    "splash"                 
## [23] "instrument"</code></pre>
<p>The second object had an additional spectra variable <em>instrument</em> that was not present in <code>sps</code> and all the spectra in this object will thus get a value of <code>NA</code> for this variable.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb51-1" data-line-number="1">sps<span class="op">$</span>instrument</a></code></pre></div>
<pre><code>## [1] NA                                    
## [2] NA                                    
## [3] NA                                    
## [4] "Agilent 1200 RRLC; Agilent 6520 QTOF"</code></pre>
<p>Sometimes not all spectra variables might be required (e.g. also because many of them are empty). This might be specifically interesting also for <code>Spectra</code> containing the data from very large experiments, because it can significantly reduce the object’s size in memory. In such cases the <code>selectSpectraVariables</code> function can be used to retain only specified spectra variables.</p>
</div>
<div id="data-manipulations" class="section level2">
<h2 class="hasAnchor">
<a href="#data-manipulations" class="anchor"></a>Data manipulations</h2>
<p>Some analyses require manipulation of the mass peak data (i.e. the m/z and/or intensity values). One example would be to remove all peaks from a spectrum that have an intensity lower than a certain threshold. Below we perform such an operation with the <code>removePeaks</code> function to remove peaks in each spectrum in <code>sps</code> with an intensity below 10. Note that this function does not actually <em>remove</em> the peaks, but sets their intensity to <code>0</code>.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb53-1" data-line-number="1">sps &lt;-<span class="st"> </span><span class="kw"><a href="../reference/hidden_aliases.html">removePeaks</a></span>(sps, <span class="dt">threshold =</span> <span class="dv">10</span>)</a></code></pre></div>
<p>As a result intensities below 10 were set to 0 for all peaks.</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb54-1" data-line-number="1"><span class="kw">intensity</span>(sps)</a></code></pre></div>
<pre><code>## NumericList of length 4
## [[1]] 0 47.494 0 100 13.24
## [[2]] 0 0 0 16.708 100 0 40.643
## [[3]] 0 0 0 0 0 0 0 100 40.994
## [[4]] 0 32.341 0 0 100</code></pre>
<p>Zero-intensity peaks can then be removed with the <code>clean</code> function.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb56-1" data-line-number="1">sps &lt;-<span class="st"> </span><span class="kw"><a href="../reference/hidden_aliases.html">clean</a></span>(sps, <span class="dt">all =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb57-1" data-line-number="1"><span class="kw">intensity</span>(sps)</a></code></pre></div>
<pre><code>## NumericList of length 4
## [[1]] 47.494 100 13.24
## [[2]] 16.708 100 40.643
## [[3]] 100 40.994
## [[4]] 32.341 100</code></pre>
<p>Note that any data manipulations on <code>Spectra</code> objects are not immediately applied to the peak data. They are added to a so called <em>processing queue</em> which is applied each time peak data is accessed (with the <code>as.list</code>, <code>mz</code> or <code>intensity</code> functions). Thanks to this processing queue data manipulation operations are also possible for <em>read-only</em> backends (e.g. mzML-file based backends or database-based backends). The information about the number of such processing steps can be seen below (next to <em>Lazy evaluation queue</em>).</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb59-1" data-line-number="1">sps</a></code></pre></div>
<pre><code>## MSn data (Spectra) with 4 spectra in a MsBackendDataFrame backend:
##     msLevel     rtime scanIndex
##   &lt;integer&gt; &lt;numeric&gt; &lt;integer&gt;
## 1         2        NA        NA
## 2         2        NA        NA
## 3         2        NA        NA
## 4         2        NA        NA
##  ... 20 more variables/columns.
## Lazy evaluation queue: 2 processing step(s)
## Processing:
##  Merge 2 Spectra into one [Thu Dec  5 09:15:29 2019]
##  Signal &lt;= 10 in MS level(s) 2 set to 0 [Thu Dec  5 09:15:29 2019]
##  Spectra of MS level(s) 2 cleaned. [Thu Dec  5 09:15:29 2019]</code></pre>
<p>It is possible to add also custom functions to the processing queue of a <code>Spectra</code> object. Such a function must take a peaks matrix as its first argument, have <code>...</code> in the function definition and must return a peaks matrix (a peaks matrix is a numeric two-column matrix with the first column containing the peaks’ m/z values and the second the corresponding intensities). Below we define a function that divides the intensities of each peak by a value which can be passed with argument <code>y</code>.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb61-1" data-line-number="1">## Define a function that takes a matrix as input, divides the second</a>
<a class="sourceLine" id="cb61-2" data-line-number="2">## column by parameter y and returns it. Note that ... is required in</a>
<a class="sourceLine" id="cb61-3" data-line-number="3">## the function's definition.</a>
<a class="sourceLine" id="cb61-4" data-line-number="4">divide_intensities &lt;-<span class="st"> </span><span class="cf">function</span>(x, y, ...) {</a>
<a class="sourceLine" id="cb61-5" data-line-number="5">    x[, <span class="dv">2</span>] &lt;-<span class="st"> </span>x[, <span class="dv">2</span>] <span class="op">/</span><span class="st"> </span>y</a>
<a class="sourceLine" id="cb61-6" data-line-number="6">    x</a>
<a class="sourceLine" id="cb61-7" data-line-number="7">}</a>
<a class="sourceLine" id="cb61-8" data-line-number="8"></a>
<a class="sourceLine" id="cb61-9" data-line-number="9">## Add the function to the procesing queue</a>
<a class="sourceLine" id="cb61-10" data-line-number="10">sps_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw"><a href="../reference/Spectra.html">addProcessing</a></span>(sps, divide_intensities, <span class="dt">y =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb61-11" data-line-number="11">sps_<span class="dv">2</span></a></code></pre></div>
<pre><code>## MSn data (Spectra) with 4 spectra in a MsBackendDataFrame backend:
##     msLevel     rtime scanIndex
##   &lt;integer&gt; &lt;numeric&gt; &lt;integer&gt;
## 1         2        NA        NA
## 2         2        NA        NA
## 3         2        NA        NA
## 4         2        NA        NA
##  ... 20 more variables/columns.
## Lazy evaluation queue: 3 processing step(s)
## Processing:
##  Merge 2 Spectra into one [Thu Dec  5 09:15:29 2019]
##  Signal &lt;= 10 in MS level(s) 2 set to 0 [Thu Dec  5 09:15:29 2019]
##  Spectra of MS level(s) 2 cleaned. [Thu Dec  5 09:15:29 2019]</code></pre>
<p>Object <code>sps_2</code> has now 3 processing steps in its lazy evaluation queue. Calling <code>intensity</code> on this object will now return intensities that are half of the intensities of the original objects <code>sps</code>.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb63-1" data-line-number="1"><span class="kw">intensity</span>(sps_<span class="dv">2</span>)</a></code></pre></div>
<pre><code>## NumericList of length 4
## [[1]] 23.747 50 6.62
## [[2]] 8.354 50 20.3215
## [[3]] 50 20.497
## [[4]] 16.1705 50</code></pre>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb65-1" data-line-number="1"><span class="kw">intensity</span>(sps)</a></code></pre></div>
<pre><code>## NumericList of length 4
## [[1]] 47.494 100 13.24
## [[2]] 16.708 100 40.643
## [[3]] 100 40.994
## [[4]] 32.341 100</code></pre>
<p>Alternatively we could define a function that returns the maximum peak from each spectrum:</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb67-1" data-line-number="1">max_peak &lt;-<span class="st"> </span><span class="cf">function</span>(x, ...) {</a>
<a class="sourceLine" id="cb67-2" data-line-number="2">    x[<span class="kw"><a href="https://rdrr.io/r/base/which.min.html">which.max</a></span>(x[, <span class="dv">2</span>]), , drop =<span class="st"> </span><span class="ot">FALSE</span>]</a>
<a class="sourceLine" id="cb67-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb67-4" data-line-number="4"></a>
<a class="sourceLine" id="cb67-5" data-line-number="5">sps_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw"><a href="../reference/Spectra.html">addProcessing</a></span>(sps, max_peak)</a>
<a class="sourceLine" id="cb67-6" data-line-number="6"><span class="kw"><a href="https://rdrr.io/r/base/lengths.html">lengths</a></span>(sps_<span class="dv">2</span>)</a></code></pre></div>
<pre><code>## [1] 1 1 1 1</code></pre>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb69-1" data-line-number="1"><span class="kw">intensity</span>(sps_<span class="dv">2</span>)</a></code></pre></div>
<pre><code>## NumericList of length 4
## [[1]] intensity=100
## [[2]] intensity=100
## [[3]] intensity=100
## [[4]] intensity=100</code></pre>
<p>Each spectrum in <code>sps_2</code> thus contains only a single peak.</p>
<p>Finally, for <code>Spectra</code> that use a <em>writeable</em> backend, such as the <code>MsBackendDataFrame</code> or <code>MsBackendHdf5Peaks</code>, it is possible to apply the processing queue to the peak data and write that back to the data storage with the <code>applyProcessing</code> function. Below we use this to make all data manipulations on peak data of the <code>sps</code> object persistent.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb71-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(sps<span class="op">@</span>processingQueue)</a></code></pre></div>
<pre><code>## [1] 2</code></pre>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb73-1" data-line-number="1">sps &lt;-<span class="st"> </span><span class="kw"><a href="../reference/Spectra.html">applyProcessing</a></span>(sps)</a>
<a class="sourceLine" id="cb73-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(sps<span class="op">@</span>processingQueue)</a></code></pre></div>
<pre><code>## [1] 0</code></pre>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb75-1" data-line-number="1">sps</a></code></pre></div>
<pre><code>## MSn data (Spectra) with 4 spectra in a MsBackendDataFrame backend:
##     msLevel     rtime scanIndex
##   &lt;integer&gt; &lt;numeric&gt; &lt;integer&gt;
## 1         2        NA        NA
## 2         2        NA        NA
## 3         2        NA        NA
## 4         2        NA        NA
##  ... 20 more variables/columns.
## Processing:
##  Merge 2 Spectra into one [Thu Dec  5 09:15:29 2019]
##  Signal &lt;= 10 in MS level(s) 2 set to 0 [Thu Dec  5 09:15:29 2019]
##  Spectra of MS level(s) 2 cleaned. [Thu Dec  5 09:15:29 2019]
##  Applied processing queue with 2 steps [Thu Dec  5 09:15:29 2019]</code></pre>
<p>Before <code>applyProcessing</code> the lazy evaluation queue contained 2 processing steps, which were then applied to the peak data and <em>written</em> to the data storage.</p>
</div>
<div id="changing-backends" class="section level2">
<h2 class="hasAnchor">
<a href="#changing-backends" class="anchor"></a>Changing backends</h2>
<p>In the previous sections we learned already that a <code>Spectra</code> object can use different backends for the actual data handling. It is also possible to change the backend of a <code>Spectra</code> to a different one with the <code>setBackend</code> function. We could for example change the (<code>MsBackendMzR</code>) backend of the <code>sps_sciex</code> object to a <code>MsBackendDataFrame</code> backend to enable use of the data even without the need to keep the original mzML files. Below we change the backend of <code>sps_sciex</code> to the in-memory <code>MsBackendDataFrame</code> backend.</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb77-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="kw"><a href="https://rdrr.io/r/utils/object.size.html">object.size</a></span>(sps_sciex), <span class="dt">units =</span> <span class="st">"Mb"</span>)</a></code></pre></div>
<pre><code>## 0.2 Mb</code></pre>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb79-1" data-line-number="1">sps_sciex &lt;-<span class="st"> </span><span class="kw"><a href="../reference/hidden_aliases.html">setBackend</a></span>(sps_sciex, <span class="kw"><a href="../reference/MsBackend.html">MsBackendDataFrame</a></span>())</a>
<a class="sourceLine" id="cb79-2" data-line-number="2">sps_sciex</a></code></pre></div>
<pre><code>## MSn data (Spectra) with 1862 spectra in a MsBackendDataFrame backend:
##        msLevel         rtime scanIndex
##      &lt;integer&gt;     &lt;numeric&gt; &lt;integer&gt;
## 1            1 0.28000000002         1
## 2            1 0.55900000002         2
## 3            1 0.83800000002         3
## 4            1 1.11700000002         4
## 5            1 1.39600000002         5
## ...        ...           ...       ...
## 1858         1       258.636       927
## 1859         1       258.915       928
## 1860         1       259.194       929
## 1861         1       259.473       930
## 1862         1       259.752       931
##  ... 33 more variables/columns.
## Processing:
##  Switch backend from MsBackendMzR to MsBackendDataFrame [Thu Dec  5 09:15:32 2019]</code></pre>
<p>With the call the full peak data was imported from the original mzML files into the object. This has obviously an impact on the object’s size, which is now much larger than before.</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb81-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="kw"><a href="https://rdrr.io/r/utils/object.size.html">object.size</a></span>(sps_sciex), <span class="dt">units =</span> <span class="st">"Mb"</span>)</a></code></pre></div>
<pre><code>## 52.1 Mb</code></pre>
<p>The <code>dataStorage</code> spectrum variable has now changed, while <code>dataOrigin</code> still keeps the information about the originating files:</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb83-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="kw">dataStorage</span>(sps_sciex))</a></code></pre></div>
<pre><code>## [1] "&lt;memory&gt;" "&lt;memory&gt;" "&lt;memory&gt;" "&lt;memory&gt;" "&lt;memory&gt;" "&lt;memory&gt;"</code></pre>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb85-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/basename.html">basename</a></span>(<span class="kw">dataOrigin</span>(sps_sciex)))</a></code></pre></div>
<pre><code>## [1] "20171016_POOL_POS_1_105-134.mzML" "20171016_POOL_POS_1_105-134.mzML"
## [3] "20171016_POOL_POS_1_105-134.mzML" "20171016_POOL_POS_1_105-134.mzML"
## [5] "20171016_POOL_POS_1_105-134.mzML" "20171016_POOL_POS_1_105-134.mzML"</code></pre>
</div>
<div id="parallel-processing-notes" class="section level2">
<h2 class="hasAnchor">
<a href="#parallel-processing-notes" class="anchor"></a>Parallel processing notes</h2>
<p>Most functions on <code>Spectra</code> support (and use) parallel processing out of the box. Peak data access and manipulation methods perform by default parallel processing on a per-file basis. <code>Spectra</code> uses <em><a href="https://bioconductor.org/packages/3.11/BiocParallel">BiocParallel</a></em> for parallel processing and all functions use the default registered parallel processing setup of that package.</p>
</div>
</div>
<div id="backends" class="section level1">
<h1 class="hasAnchor">
<a href="#backends" class="anchor"></a>Backends</h1>
<p>Backends allow to use different <em>backends</em> to store mass spectrometry data while providing <em>via</em> the <code>Spectra</code> class a unified interface to use that data. The <code>Spectra</code> package defines a set of example backends but any object extending the base <code>MsBackend</code> class could be used instead. The default backends are:</p>
<ul>
<li><p><code>MsBackendDataFrame</code>: the mass spectrometry data is stored (in-memory) in a <code>DataFrame</code>. Keeping the data in memory guarantees high performance but has also, depending on the number of mass peaks in each spectrum, a much higher memory footprint.</p></li>
<li><p><code>MsBackendMzR</code>: this backend keeps only general spectra variables in memory and relies on the <em><a href="https://bioconductor.org/packages/3.11/mzR">mzR</a></em> package to read mass peaks (m/z and intensity values) from the original MS files on-demand.</p></li>
<li><p><code>MsBackendHdf5Peaks</code>: similar to <code>MsBackendMzR</code> this backend reads peak data only on-demand from disk while all other spectra variables are kept in memory. The peak data are stored in Hdf5 files which guarantees scalability.</p></li>
</ul>
<p>All of the above mentioned backends support changing all of their their spectra variables, <strong>except</strong> the <code>MsBackendMzR</code> that does not support changing m/z or intensity values for the mass peaks.</p>
<p>With the example below we load the data from a single mzML file and use a <code>MsBackendHdf5Peaks</code> backend for data storage. The <code>hdf5path</code> parameter allows us to specify the storage location of the HDF5 file.</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb87-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(msdata)</a>
<a class="sourceLine" id="cb87-2" data-line-number="2">fl &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/msdata/man/proteomics.html">proteomics</a></span>(<span class="dt">full.names =</span> <span class="ot">TRUE</span>)[<span class="dv">5</span>]</a>
<a class="sourceLine" id="cb87-3" data-line-number="3"></a>
<a class="sourceLine" id="cb87-4" data-line-number="4">sps_tmt &lt;-<span class="st"> </span><span class="kw"><a href="../reference/Spectra.html">Spectra</a></span>(fl, <span class="dt">backend =</span> <span class="kw"><a href="../reference/MsBackend.html">MsBackendHdf5Peaks</a></span>(), <span class="dt">hdf5path =</span> <span class="kw"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span>())</a>
<a class="sourceLine" id="cb87-5" data-line-number="5"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/basename.html">basename</a></span>(<span class="kw">dataStorage</span>(sps_tmt)))</a></code></pre></div>
<pre><code>## [1] "TMT_Erwinia_1uLSike_Top10HCD_isol2_45stepped_60min_01.mzML.h5"
## [2] "TMT_Erwinia_1uLSike_Top10HCD_isol2_45stepped_60min_01.mzML.h5"
## [3] "TMT_Erwinia_1uLSike_Top10HCD_isol2_45stepped_60min_01.mzML.h5"
## [4] "TMT_Erwinia_1uLSike_Top10HCD_isol2_45stepped_60min_01.mzML.h5"
## [5] "TMT_Erwinia_1uLSike_Top10HCD_isol2_45stepped_60min_01.mzML.h5"
## [6] "TMT_Erwinia_1uLSike_Top10HCD_isol2_45stepped_60min_01.mzML.h5"</code></pre>
</div>
<div id="session-information" class="section level1">
<h1 class="hasAnchor">
<a href="#session-information" class="anchor"></a>Session information</h1>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb89-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/utils/sessionInfo.html">sessionInfo</a></span>()</a></code></pre></div>
<pre><code>## R Under development (unstable) (2019-12-04 r77518)
## Platform: x86_64-pc-linux-gnu (64-bit)
## Running under: Ubuntu 14.04.5 LTS
## 
## Matrix products: default
## BLAS:   /home/travis/R-bin/lib/R/lib/libRblas.so
## LAPACK: /home/travis/R-bin/lib/R/lib/libRlapack.so
## 
## locale:
##  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              
##  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    
##  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   
##  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 
##  [9] LC_ADDRESS=C               LC_TELEPHONE=C            
## [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       
## 
## attached base packages:
## [1] parallel  stats4    stats     graphics  grDevices utils     datasets 
## [8] methods   base     
## 
## other attached packages:
## [1] msdata_0.27.0       magrittr_1.5        Spectra_0.3.0      
## [4] ProtGenerics_1.17.4 BiocParallel_1.21.0 S4Vectors_0.25.4   
## [7] BiocGenerics_0.33.0 BiocStyle_2.15.0   
## 
## loaded via a namespace (and not attached):
##  [1] Rcpp_1.0.3          compiler_4.0.0      BiocManager_1.30.10
##  [4] tools_4.0.0         ncdf4_1.17          digest_0.6.23      
##  [7] evaluate_0.14       memoise_1.1.0       rhdf5_2.31.1       
## [10] rlang_0.4.2         yaml_2.2.0          pkgdown_1.4.1      
## [13] xfun_0.11           stringr_1.4.0       knitr_1.26         
## [16] desc_1.2.0          fs_1.3.1            IRanges_2.21.2     
## [19] MsCoreUtils_0.0.2   rprojroot_1.3-2     Biobase_2.47.1     
## [22] R6_2.4.1            rmarkdown_1.18      bookdown_0.16      
## [25] Rhdf5lib_1.9.0      mzR_2.21.0          backports_1.1.5    
## [28] codetools_0.2-16    htmltools_0.4.0     MASS_7.3-51.4      
## [31] assertthat_0.2.1    stringi_1.4.3       crayon_1.3.4</code></pre>
</div>
<div id="references" class="section level1">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li>
<a href="#general-usage">General usage</a><ul class="nav nav-pills nav-stacked">
<li><a href="#creating-spectra-objects">Creating <code>Spectra</code> objects</a></li>
      <li><a href="#accessing-spectrum-data">Accessing spectrum data</a></li>
      <li><a href="#filtering-subsetting-and-merging">Filtering, subsetting and merging</a></li>
      <li><a href="#data-manipulations">Data manipulations</a></li>
      <li><a href="#changing-backends">Changing backends</a></li>
      <li><a href="#parallel-processing-notes">Parallel processing notes</a></li>
      </ul>
</li>
      <li><a href="#backends">Backends</a></li>
      <li><a href="#session-information">Session information</a></li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Laurent Gatto, Johannes Rainer, Sebastian Gibb.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
